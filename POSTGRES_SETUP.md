# PostgreSQL è³‡æ–™åº«è¨­å®šæŒ‡å—

## ğŸ“‹ åœ¨ Render ä¸­å‰µå»º PostgreSQL è³‡æ–™åº«

### ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬è¨­å®š

åœ¨ Render çš„ "New Postgres" é é¢ä¸­ï¼Œè¨­å®šä»¥ä¸‹é …ç›®ï¼š

#### 1. Nameï¼ˆåç¨±ï¼‰
- **é è¨­å€¼**ï¼š`majon_db`ï¼ˆå·²é¡¯ç¤ºï¼‰
- **å»ºè­°**ï¼šæ”¹ç‚º `mojan-database`ï¼ˆèˆ‡ `render.yaml` ä¸­çš„åç¨±ä¸€è‡´ï¼‰
- **èªªæ˜**ï¼šé€™æ˜¯è³‡æ–™åº«å¯¦ä¾‹çš„å”¯ä¸€åç¨±

#### 2. Projectï¼ˆå°ˆæ¡ˆï¼Œå¯é¸ï¼‰
- **ç›®å‰ç‹€æ…‹**ï¼šé¡¯ç¤º "Create a new project to add this to?"
- **å»ºè­°**ï¼š
  - å¦‚æœä¸éœ€è¦å°ˆæ¡ˆç®¡ç†ï¼Œå¯ä»¥ç•™ç©º
  - å¦‚æœéœ€è¦ï¼Œå¯ä»¥é»æ“Š "+ Create a project" å‰µå»ºæ–°å°ˆæ¡ˆ
  - æˆ–ç¨å¾Œå†æ·»åŠ åˆ°å°ˆæ¡ˆ

#### 3. Databaseï¼ˆè³‡æ–™åº«åç¨±ï¼Œå¯é¸ï¼‰
- **é è¨­å€¼**ï¼š`randomly generated unless specified`
- **å»ºè­°**ï¼šè¨­ç‚º `mojan_db`ï¼ˆèˆ‡ `render.yaml` ä¸­çš„ `databaseName` ä¸€è‡´ï¼‰
- **èªªæ˜**ï¼šé€™æ˜¯ PostgreSQL å…§éƒ¨çš„è³‡æ–™åº«åç¨±

#### 4. Userï¼ˆç”¨æˆ¶åï¼Œå¯é¸ï¼‰
- **é è¨­å€¼**ï¼š`randomly generated unless specified`
- **å»ºè­°**ï¼šè¨­ç‚º `mojan_user`ï¼ˆèˆ‡ `render.yaml` ä¸­çš„ `user` ä¸€è‡´ï¼‰
- **èªªæ˜**ï¼šé€™æ˜¯è³‡æ–™åº«çš„ç”¨æˆ¶å

#### 5. Regionï¼ˆå€åŸŸï¼‰
- **ç›®å‰é¸æ“‡**ï¼š`Singapore (Southeast Asia)`ï¼ˆå·²é¸ä¸­ï¼Œç´«è‰²èƒŒæ™¯ï¼‰
- **èªªæ˜**ï¼šæ‚¨ç›®å‰æœ‰ 8 å€‹æœå‹™åœ¨ Singaporeï¼Œ2 å€‹æœå‹™åœ¨ Oregon
- **å»ºè­°**ï¼š
  - å¦‚æœå…¶ä»–æœå‹™åœ¨ Singaporeï¼Œé¸æ“‡ `Singapore`
  - å¦‚æœå…¶ä»–æœå‹™åœ¨ Oregonï¼Œé¸æ“‡ `Oregon`
  - å»ºè­°æ‰€æœ‰æœå‹™åœ¨åŒä¸€å€åŸŸï¼Œä»¥æ¸›å°‘å»¶é²

#### 6. PostgreSQL Versionï¼ˆPostgreSQL ç‰ˆæœ¬ï¼‰
- **ç›®å‰é¡¯ç¤º**ï¼š`17`
- **èªªæ˜**ï¼šé€™æ˜¯ PostgreSQL çš„ç‰ˆæœ¬è™Ÿ
- **å»ºè­°**ï¼šä½¿ç”¨é è¨­å€¼ `17`ï¼ˆæœ€æ–°ç©©å®šç‰ˆï¼‰

### ç¬¬äºŒæ­¥ï¼šå‰µå»ºè³‡æ–™åº«

1. **æª¢æŸ¥æ‰€æœ‰è¨­å®š**ï¼š
   - Name: `mojan-database`
   - Database: `mojan_db`
   - User: `mojan_user`
   - Region: `Singapore`ï¼ˆæˆ–æ ¹æ“šå…¶ä»–æœå‹™é¸æ“‡ï¼‰
   - PostgreSQL Version: `17`

2. **é»æ“Š "Create Postgres"** æŒ‰éˆ•

3. **ç­‰å¾…è³‡æ–™åº«å‰µå»ºå®Œæˆ**ï¼ˆç´„ 1-2 åˆ†é˜ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šå–å¾— Internal Database URL

è³‡æ–™åº«å‰µå»ºå®Œæˆå¾Œï¼š

1. **é€²å…¥è³‡æ–™åº«æœå‹™é é¢**ï¼š
   - åœ¨ Render Dashboard ä¸­ï¼Œé»æ“Š `mojan-database` æœå‹™

2. **æ‰¾åˆ° "Internal Database URL"**ï¼š
   - åœ¨æœå‹™é é¢ä¸­ï¼Œæ‰¾åˆ° "Connections" æˆ– "Database" å€å¡Š
   - æ‰¾åˆ° "Internal Database URL" æˆ– "Connection String"
   - **è¤‡è£½é€™å€‹ URL**

3. **URL æ ¼å¼**ï¼š
   ```
   postgresql://mojan_user:password@dpg-xxxxx-a.singapore-postgres.render.com/mojan_db
   ```

### ç¬¬å››æ­¥ï¼šè¨­å®šå…¶ä»–æœå‹™çš„ç’°å¢ƒè®Šæ•¸

å–å¾— Internal Database URL å¾Œï¼Œéœ€è¦åœ¨å…¶ä»–æœå‹™ä¸­è¨­å®šï¼š

#### 1. mojan-server æœå‹™
- é€²å…¥ `mojan-server` æœå‹™è¨­å®š
- æ‰¾åˆ° "Environment" æ¨™ç±¤
- è¨­å®š `DATABASE_URL` = ï¼ˆè²¼ä¸Šå‰›æ‰è¤‡è£½çš„ Internal Database URLï¼‰

#### 2. mojan-admin æœå‹™
- é€²å…¥ `mojan-admin` æœå‹™è¨­å®š
- æ‰¾åˆ° "Environment" æ¨™ç±¤
- è¨­å®š `DATABASE_URL` = ï¼ˆè²¼ä¸Šå‰›æ‰è¤‡è£½çš„ Internal Database URLï¼‰

### ç¬¬äº”æ­¥ï¼šåŸ·è¡Œè³‡æ–™åº«é·ç§»

è¨­å®šå®Œç’°å¢ƒè®Šæ•¸å¾Œï¼Œéœ€è¦åŸ·è¡Œè³‡æ–™åº«é·ç§»ï¼š

1. **é€²å…¥ mojan-server æœå‹™**ï¼š
   - åœ¨ Render Dashboard ä¸­ï¼Œé»æ“Š `mojan-server` æœå‹™

2. **æ‰“é–‹ Shell**ï¼š
   - é»æ“Šå·¦å´é¸å–®çš„ "Shell" æ¨™ç±¤

3. **åŸ·è¡Œé·ç§»å‘½ä»¤**ï¼š
   ```bash
   npx prisma migrate deploy
   ```

4. **ç­‰å¾…é·ç§»å®Œæˆ**ï¼š
   - é·ç§»æœƒå‰µå»ºæ‰€æœ‰å¿…è¦çš„è³‡æ–™è¡¨
   - ç¢ºèªæ²’æœ‰éŒ¯èª¤è¨Šæ¯

## âš ï¸ é‡è¦æé†’

### 1. åç¨±ä¸€è‡´æ€§
- ç¢ºä¿è³‡æ–™åº«åç¨±èˆ‡ `render.yaml` ä¸­çš„è¨­å®šä¸€è‡´
- å¦‚æœä½¿ç”¨ Blueprintï¼ŒRender æœƒè‡ªå‹•ä½¿ç”¨ `render.yaml` ä¸­çš„è¨­å®š

### 2. å€åŸŸé¸æ“‡
- å»ºè­°æ‰€æœ‰æœå‹™åœ¨åŒä¸€å€åŸŸ
- åŒä¸€å€åŸŸçš„æœå‹™å¯ä»¥é€šéç§æœ‰ç¶²è·¯é€šè¨Šï¼Œé€Ÿåº¦æ›´å¿«

### 3. å®‰å…¨è¨­å®š
- Internal Database URL åªèƒ½åœ¨ Render å…§éƒ¨ä½¿ç”¨
- ä¸è¦å°‡ Internal Database URL æäº¤åˆ° Git
- å¦‚æœéœ€è¦å¤–éƒ¨é€£æ¥ï¼Œä½¿ç”¨ "External Database URL"

### 4. å…è²»æ–¹æ¡ˆé™åˆ¶
- å…è²»æ–¹æ¡ˆæœ‰è³‡æ–™åº«å¤§å°é™åˆ¶
- å…è²»æ–¹æ¡ˆåœ¨ 90 å¤©ç„¡æ´»å‹•å¾Œæœƒåˆªé™¤è³‡æ–™

## âœ… æª¢æŸ¥æ¸…å–®

è¨­å®šå®Œæˆå¾Œï¼Œç¢ºèªï¼š

- [ ] è³‡æ–™åº«å·²å‰µå»ºä¸¦é‹è¡Œ
- [ ] Internal Database URL å·²å–å¾—
- [ ] `mojan-server` çš„ `DATABASE_URL` å·²è¨­å®š
- [ ] `mojan-admin` çš„ `DATABASE_URL` å·²è¨­å®š
- [ ] è³‡æ–™åº«é·ç§»å·²åŸ·è¡Œ
- [ ] æ‰€æœ‰æœå‹™éƒ½èƒ½æ­£å¸¸é€£æ¥åˆ°è³‡æ–™åº«

---

æœ€å¾Œæ›´æ–°ï¼š2024å¹´11æœˆ

