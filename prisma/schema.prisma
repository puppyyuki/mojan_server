generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Player {
  id        String   @id @default(cuid())
  userId    String   @unique // 6位數字，唯一
  nickname  String   @unique
  cardCount Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  createdClubs Club[] @relation("ClubCreator")
  clubMembers  ClubMember[]
  createdRooms Room[] @relation("RoomCreator")

  @@map("players")
}

model Club {
  id        String   @id @default(cuid())
  clubId    String   @unique // 6位數字，唯一
  name      String
  creatorId String
  creator   Player   @relation("ClubCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  cardCount Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  members ClubMember[]
  rooms   Room[]

  @@map("clubs")
}

model ClubMember {
  id       String   @id @default(cuid())
  clubId   String
  club     Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  playerId String
  player   Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
  joinedAt DateTime @default(now())

  @@unique([clubId, playerId])
  @@map("club_members")
}

model Room {
  id            String   @id @default(cuid())
  roomId        String   @unique // 6位數字，唯一
  clubId        String?
  club          Club?    @relation(fields: [clubId], references: [id], onDelete: SetNull)
  creatorId     String
  creator       Player   @relation("RoomCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  currentPlayers Int      @default(0)
  maxPlayers    Int      @default(4)
  status        String   @default("WAITING") // WAITING, PLAYING, FINISHED
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("rooms")
}

